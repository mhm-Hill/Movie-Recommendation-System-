<!DOCTYPE html>
<html id="browse-page" lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تصفح الأفلام</title>
    <link rel="stylesheet" href="/static/browser.css"> 
    <link rel="stylesheet" href="/static/navigation.css">
    <script src="/static/watchlist.js" defer></script>
</head>
<body id="browse-page" lang="ar" dir="rtl">
    {% include 'navigation.html' %}

    <div class="container">
        <h1>تصفح الأفلام</h1>

        {% if error_message %}
            <p class="error-message">{{ error_message }}</p>
        {% endif %}

        <form action="/browse" method="GET" class="browse-form">
            <input type="text" name="search_query" placeholder="ابحث عن فيلم بالاسم..." value="{{ search_query if search_query else '' }}">
            <select name="genre">
                <option value="">كل الأنواع</option>
                {% for genre_item in available_genres %}
                <option value="{{ genre_item.Genre_id }}" {% if selected_genre and genre_item.Genre_id|string == selected_genre|string %}selected{% endif %}>{{ genre_item.Title }}</option>
                {% endfor %}
            </select>
            <button type="submit">بحث</button>
        </form>

        <div class="movie-list">
            {% if movies and movies|length > 0 %}
                {% for movie in movies %}
                    <div class="movie-item">
                        {% if movie.Poster_URL %}
                            <img src="{{ movie.Poster_URL }}" alt="Poster for {{ movie.Name }}" class="movie-poster">
                        {% endif %}
                        <a href="/movie?id={{ movie.Movie_id }}" class="movie-title-link">
                            <h2>{{ movie.Name }}</h2>
                        </a>
                        <p><strong>النوع:</strong> {{ movie.Genre }}</p>
                        <p><strong>المنصة:</strong> {{ movie.Platform }}</p>
                        <p><strong>سنة الإصدار:</strong> {{ movie.Release_year }}</p>
                        <p><strong>المدة:</strong> {{ movie.Duration }} دقيقة</p>
                        <button class="watchlist-btn" data-movie-id="{{ movie.Movie_id }}">أضف للمشاهدة</button>
                    </div>
                     
                {% endfor %}
            {% elif (search_query or selected_genre) and not error_message %}
                <p>لا توجد أفلام تطابق معايير البحث أو الفلترة الحالية.</p>
            {% elif not error_message %}
                <p>لا توجد أفلام لعرضها حالياً. حاول البحث أو تغيير الفلاتر.</p>
            {% endif %}
        </div>
        {% if total_pages > 1 %}
        <div class="pagination">
            {% if current_page > 1 %}
                <a href="/browse?search_query={{search_query}}&genre={{selected_genre}}&page={{current_page - 1}}">&laquo; السابق</a>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                {% if p == current_page %}
                    <a href="#" class="active">{{ p }}</a>
                {% else %}
                    <a href="/browse?search_query={{search_query}}&genre={{selected_genre}}&page={{p}}">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if current_page < total_pages %}
                <a href="/browse?search_query={{search_query}}&genre={{selected_genre}}&page={{current_page + 1}}">التالي &raquo;</a>
            {% endif %}
           
        </div>
        {% endif %}
        <p class="dashboard-link"><a href="/dashboard">العودة إلى لوحة التحكم</a></p>
    </div>
</body>
</html>    
       